import os
from pathlib import Path

from dotenv import load_dotenv

load_dotenv()

BASE_DIR = Path(__file__).resolve().parent.parent

TELEGRAM_BOT_TOKEN: str = os.environ["TELEGRAM_BOT_TOKEN"]
NAVER_CLIENT_ID: str = os.environ["NAVER_CLIENT_ID"]
NAVER_CLIENT_SECRET: str = os.environ["NAVER_CLIENT_SECRET"]
FERNET_KEY: str = os.environ["FERNET_KEY"]
DB_PATH: str = os.environ.get("DB_PATH", str(BASE_DIR / "data" / "tasa-check.db"))

# /check 시간 윈도우 최대값 (초)
CHECK_MAX_WINDOW_SECONDS: int = 3 * 60 * 60

# /report 시간 윈도우 (초) — 최근 3시간 기사 수집
REPORT_MAX_WINDOW_SECONDS: int = 3 * 60 * 60

# 캐시 보관 기간 (일)
CACHE_RETENTION_DAYS: int = 5

# 관리자 Telegram ID
ADMIN_TELEGRAM_ID: str = "8571411084"

# 부서별 프로필 (취재 영역 + 중요도 판단 기준)
DEPARTMENT_PROFILES: dict[str, dict] = {
    "사회부": {
        "coverage": (
            "사건·사고, 경찰·검찰 수사, 법원 재판, 인권, 재난·안전, 교육, 노동, 환경, 지방자치, "
            "부동산·주거 (시민 생활 영향), 의료·보건·복지, 인구·저출생·고령화, 소비자·생활경제"
        ),
        "criteria": [
            "공식 수사 조치: 체포, 구속, 기소, 영장 청구/기각, 판결 선고",
            "중대 사건·사고: 다수 사상자 발생, 사회적 관심이 집중된 대형 사건·재난",
            "수사 국면 전환: 소환→구속, 수사→기소, 1심→항소 등 단계 변화",
            "사회적 파장: 다수 언론 보도, 여론 형성, 후속 보도 가능성 높은 사안",
            "사회 구조적 이슈: 부동산·주거, 인구, 의료·복지 등 시민 생활에 직접 영향을 미치는 정책 발표 또는 통계",
        ],
        "report_keywords": [
            "경찰 수사", "검찰 기소", "법원 판결", "사건사고",
            "재난 안전", "교육 정책", "노동 노사",
            "부동산 정책", "의료 보건", "복지 정책",
            "인권 차별", "환경 기후", "저출생 고령화",
        ],
    },
    "정치부": {
        "coverage": (
            "국회 입법, 정당 동향, 대통령실·행정부, 선거, 외교·안보, 남북관계, 헌법재판소, "
            "검찰·법무 (정치적 측면), 여론·정치 지형 변화"
        ),
        "criteria": [
            "입법 조치: 법안 발의·통과·부결, 상임위 의결, 본회의 표결",
            "행정부 결정: 대통령 발언·지시, 국무회의 의결, 장관급 인사",
            "정당 동향: 지도부 교체, 당론 변경, 공천·징계 등 공식 결정",
            "외교·안보: 정상회담, 조약·협정, 대북 관련 공식 조치",
        ],
        "report_keywords": [
            "국회", "대통령실", "여당", "야당",
            "외교", "헌법재판소", "선거",
            "국무회의", "정당", "남북관계",
            "안보 국방", "법무부 검찰",
        ],
    },
    "경제부": {
        "coverage": (
            "거시경제, 금융·통화 정책, 부동산, 세제·재정, 금융감독, 가계·소비 지표, "
            "가상자산·핀테크, 국제경제 (Fed 등 국내 파급력 있는 해외 이슈), 물가·생활경제"
        ),
        "criteria": [
            "정책 결정: 기준금리 변동, 세제 개편, 부동산 규제, 재정 정책 발표",
            "주요 지표: GDP, 물가, 고용, 수출입, 가계부채 등 공식 통계 발표",
            "금융 이슈: 금융사 제재, 시장 급변동, 환율·주가 유의미한 변동",
            "규제·감독: 공정위 제재, 금감원 조치, 대규모 과징금 부과",
            "국제경제: 주요국 통화 정책, 글로벌 경기 지표 등 국내 시장에 직접 영향을 미치는 해외 동향",
        ],
        "report_keywords": [
            "기준금리", "부동산 규제", "물가 상승",
            "수출 실적", "금융 정책", "환율",
            "가계부채", "GDP", "세제 개편",
            "가상자산 코인", "공정위 금감원", "고용 실업", "미국 연준",
        ],
    },
    "산업부": {
        "coverage": (
            "삼성·LG·SK·현대·롯데·한화·포스코·GS 등 주요 대기업 그룹, 중소·중견기업, "
            "통신(SKT·KT·LGU+), 에너지·전력, 유통·물류(쿠팡·신세계·CJ 등), "
            "건설·인프라, ESG·탄소중립, 통상·무역"
        ),
        "criteria": [
            "대기업 주요 결정: 그룹 차원 M&A, 대규모 투자(조 단위), 사업 철수·진출, 총수·경영진 인사",
            "산업 정책: 정부 산업 지원책, 규제 변경, 통상·관세 조치, FTA",
            "시장 판도 변화: 업계 1·2위 경쟁 구도 변화, 공급망 재편, 대형 수주·계약",
            "에너지·인프라: 전력·가스 수급 이슈, 대형 건설 프로젝트, 물류 구조 재편",
        ],
        "report_keywords": [
            "삼성그룹", "LG그룹", "SK그룹", "현대차그룹",
            "롯데 한화 포스코", "SKT KT 통신",
            "에너지 전력", "유통 쿠팡 신세계",
            "건설 인프라", "탄소중립 ESG", "통상 관세 FTA", "물류 CJ",
        ],
    },
    "테크부": {
        "coverage": (
            "반도체·디스플레이(삼성전자·SK하이닉스), 배터리·2차전지(LG에너지솔루션·삼성SDI·SK온), "
            "자동차·모빌리티(현대차·기아), AI·로봇, 바이오·제약, "
            "스타트업·벤처, 핀테크, 클라우드·데이터센터"
        ),
        "criteria": [
            "기술 패권: 반도체·AI·배터리 글로벌 경쟁 구도 변화, 수출 통제·제재, 핵심 기술 확보",
            "기업 주요 결정: M&A, 대규모 설비 투자, 신사업 진출·철수, 대형 계약·수주",
            "혁신: 업계 판도를 바꿀 신기술·신제품 출시, 주요 특허 분쟁, 표준 경쟁",
            "스타트업: 1000억 이상 투자 유치, IPO, 대형 인수·합병, 주요 서비스 출시·종료",
            "바이오: 글로벌 임상 3상 결과, FDA/EMA 승인, 대형 기술 수출(CDMO) 계약",
        ],
        "report_keywords": [
            "삼성전자 반도체", "SK하이닉스", "LG에너지솔루션 배터리",
            "현대차 기아", "AI 인공지능", "바이오 신약",
            "스타트업 투자", "로봇", "클라우드 데이터센터",
            "자율주행 모빌리티", "2차전지", "핀테크",
        ],
    },
    "문화부": {
        "coverage": (
            "문화·예술, 방송·미디어, 연예, 출판, 관광, 종교, 교육 정책, 문화재, "
            "게임, 웹툰·웹소설, 한류·글로벌 콘텐츠, OTT·플랫폼"
        ),
        "criteria": [
            "수상·선정: 국제 영화제·문학상 수상, 유네스코 등재 등 공식 성과",
            "정책·제도: 문화 관련 법안·정책 발표, 교육과정 개편, 방송 규제",
            "업계 이슈: 주요 콘텐츠 흥행·논란, 플랫폼 정책 변경, 저작권 분쟁",
            "사회적 관심: 공인 관련 공식 조치(기소·판결), 대중적 파장이 큰 사안",
        ],
        "report_keywords": [
            "영화 흥행", "드라마", "방송",
            "출판", "관광", "게임",
            "웹툰", "OTT", "한류",
            "K팝 아이돌", "문화재", "문화 정책",
        ],
    },
    "스포츠부": {
        "coverage": "프로 스포츠(야구·축구·농구·배구), 국제 대회, 올림픽, e스포츠, 체육 행정",
        "criteria": [
            "경기 결과: 우승·준우승, 신기록, 시즌 주요 변곡점(매직넘버 등)",
            "선수 동향: FA·트레이드·이적, 은퇴, 부상(주전급), 징계",
            "대회·행사: 올림픽·월드컵·아시안게임 관련 공식 결정, 개최지 선정",
            "체육 행정: 협회·연맹 공식 결정, 승부조작·도핑 등 제재 조치",
        ],
        "report_keywords": [
            "프로야구", "축구 대표팀", "올림픽",
            "FA 이적", "체육 행정", "프로축구",
            "프로농구", "프로배구", "e스포츠",
            "월드컵", "아시안게임",
        ],
    },
    "국제부": {
        "coverage": (
            "국제 정치·외교, 글로벌 경제·통상, 주요국 정책(미국·중국·유럽·일본), "
            "국제 분쟁·안보, 글로벌 테크·산업, 국제기구(UN·WHO·IMF 등), 글로벌 문화·사회"
        ),
        "criteria": [
            "주요국 정책: 미국·중국·EU·일본 등 정상 발언, 행정명령, 의회 결정",
            "국제 분쟁·안보: 전쟁·군사 충돌, 제재, 동맹 관계 변화",
            "글로벌 경제: 주요국 경제 지표, 중앙은행 결정, 통상 분쟁·관세",
            "글로벌 테크: 빅테크 규제, AI 정책, 반도체 수출 통제 등 한국에 파급력 있는 해외 기술 동향",
            "국제기구: UN·WHO·IMF 등 공식 결정, 주요 보고서 발표",
        ],
        "report_keywords": [
            "미국 트럼프", "중국 시진핑", "EU 유럽",
            "우크라이나", "중동", "일본",
            "글로벌 경제", "국제 무역", "NATO",
            "UN 유엔", "워싱턴", "빅테크 규제",
        ],
    },
}

# 부서별 기사 작성 스타일 기본 가이드
WRITING_STYLES: dict[str, dict] = {
    "사회부": {
        "lead": "육하원칙 스트레이트. 첫 문장에 '누가 N일 무엇을 했다' 포함",
        "structure": "리드 → 핵심 팩트 → 배경 → 반응·전망",
        "tone": "객관적·건조체. '~했다' 종결",
        "forbidden": ["~것으로 알려졌다", "~관측이 나온다", "충격", "경악"],
        "length_default": "300~600자",
    },
    "정치부": {
        "lead": "육하원칙 스트레이트. 인물·기관 중심 서술",
        "structure": "리드 → 발언/결정 → 배경 → 파장·전망",
        "tone": "객관적·건조체. '~했다' 종결",
        "forbidden": ["~것으로 알려졌다", "파문", "충격"],
        "length_default": "300~600자",
    },
    "경제부": {
        "lead": "핵심 수치/변동 먼저 제시. '지난해 ~이 N% 증가해 N조원을 기록했다'",
        "structure": "리드(수치) → 세부 수치 → 원인 → 전망",
        "tone": "객관적·분석적. 수치와 비교 중심",
        "forbidden": ["~것으로 알려졌다", "폭등", "폭락", "대박"],
        "length_default": "300~600자",
    },
    "산업부": {
        "lead": "기업·제품·기술 중심 서술. 핵심 팩트 먼저",
        "structure": "리드 → 제품/기술 상세 → 시장 맥락 → 경쟁/전망",
        "tone": "객관적·기술적. 업계 용어 적절히 사용",
        "forbidden": ["~것으로 알려졌다", "혁신적인", "획기적인"],
        "length_default": "300~600자",
    },
    "테크부": {
        "lead": "기술·제품 핵심 변화 먼저. 독자 관점 서술",
        "structure": "리드 → 기술 상세 → 시장 영향 → 전망",
        "tone": "객관적이되 독자 친화적. 기술 용어 설명 병행",
        "forbidden": ["~것으로 알려졌다", "혁신적인", "놀라운"],
        "length_default": "300~600자",
    },
    "국제부": {
        "lead": "국가·기관 중심. 날짜(현지시각) 명시",
        "structure": "리드 → 결정/사건 상세 → 배경 → 국내 영향·전망",
        "tone": "객관적·분석적. '~일(현지 시각)' 표현",
        "forbidden": ["~것으로 알려졌다", "충격", "경악"],
        "length_default": "300~600자",
    },
    "문화부": {
        "lead": "작품·인물·행사 중심 서술",
        "structure": "리드 → 상세 내용 → 맥락 → 반응·의미",
        "tone": "객관적이되 부드러운 서술체",
        "forbidden": ["~것으로 알려졌다", "화제", "난리"],
        "length_default": "300~600자",
    },
    "스포츠부": {
        "lead": "경기 결과·기록 먼저. 스코어/순위 포함",
        "structure": "리드(결과) → 경기 하이라이트 → 선수 반응 → 향후 일정",
        "tone": "객관적이되 생동감 있는 서술",
        "forbidden": ["~것으로 알려졌다"],
        "length_default": "300~600자",
    },
}

# 부서 매칭 실패 시 기본 스타일 가이드
WRITING_STYLES_DEFAULT: dict = {
    "lead": "육하원칙 스트레이트",
    "structure": "리드 → 핵심 팩트 → 배경 → 전망",
    "tone": "객관적·건조체",
    "forbidden": ["~것으로 알려졌다"],
    "length_default": "300~600자",
}

# 부서 목록 (DEPARTMENT_PROFILES 키에서 자동 생성)
DEPARTMENTS: list[str] = list(DEPARTMENT_PROFILES.keys())
